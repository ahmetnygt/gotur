extends layout

block css
  link(rel='stylesheet' href='/css/trips.css')

block content
  - const tripList = Array.isArray(trips) ? trips : [];
  - const uniqueFirms = [];
  - const firmSet = new Set();
  - const uniqueFromStops = [];
  - const fromStopSet = new Set();
  - const uniqueToStops = [];
  - const toStopSet = new Set();
  - tripList.forEach((trip) => {
  -   const firmKey = trip.firm;
  -   if (firmKey && !firmSet.has(firmKey)) {
  -     firmSet.add(firmKey);
  -     uniqueFirms.push({ key: firmKey, label: trip.firmName || firmKey });
  -   }
  -   if (trip.fromStopId && !fromStopSet.has(trip.fromStopId)) {
  -     fromStopSet.add(trip.fromStopId);
  -     uniqueFromStops.push({ id: trip.fromStopId, label: trip.fromStr });
  -   }
  -   if (trip.toStopId && !toStopSet.has(trip.toStopId)) {
  -     toStopSet.add(trip.toStopId);
  -     uniqueToStops.push({ id: trip.toStopId, label: trip.toStr });
  -   }
  - });
  .gender-pick.border
    .d-flex.gap-3
      .m
        img(src="/svg/man.svg" alt="koltuk")
        |ERKEK
      .f
        img(src="/svg/woman.svg" alt="koltuk")
        |KADIN
  .trip-search
    select.trip-search_from.form-select.form-select-sm(value=fromId)
      option(value="17000") Çanakkale
      option(value="17500") Gelibolu
      option(value="17900") Eceabat
      option(value="22800") Keşan
      option(value="34000") İstanbul
      option(value="34220") Esenler
      option(value="34520") Beylikdüzü
      option(value="34710") Kadıköy
      option(value="59000") Tekirdağ
      option(value="59300") Malkara
      option(value="59740") Marmaraereğlisi
    select.trip-search_to.form-select.form-select-sm(value=toId)
      option(value="17000") Çanakkale
      option(value="17500") Gelibolu
      option(value="17900") Eceabat
      option(value="22800") Keşan
      option(value="34000") İstanbul
      option(value="34220") Esenler
      option(value="34520") Beylikdüzü
      option(value="34710") Kadıköy
      option(value="59000") Tekirdağ
      option(value="59300") Malkara
      option(value="59740") Marmaraereğlisi
    input.trip-search_date.form-control.form-control-sm(type="text" value=date)
    button.trip-search_search-button.btn.btn-sm.btn-primary.w-100 ARA
  .trip-actions
    .container
      .trip-actions_inner
        .trip-actions_sorting
          label.trip-actions_label(for="trip-sort-select") Sırala:
          select#trip-sort-select.form-select.form-select-sm
            option(value="departureTime") Kalkış saatine göre
            option(value="price") Fiyata göre
            option(value="duration") Varış süresine göre
        .trip-actions_filters
          .trip-filter
            label.form-label(for="trip-filter-firm") Firma
            select#trip-filter-firm.form-select.form-select-sm
              option(value="") Tüm firmalar
              each firm in uniqueFirms
                option(value=firm.key) #{firm.label}
          .trip-filter
            label.form-label(for="trip-filter-from") Kalkış noktası
            select#trip-filter-from.form-select.form-select-sm
              option(value="") Tüm kalkış noktaları
              each stop in uniqueFromStops
                option(value=stop.id) #{stop.label}
          .trip-filter
            label.form-label(for="trip-filter-to") Varış noktası
            select#trip-filter-to.form-select.form-select-sm
              option(value="") Tüm varış noktaları
              each stop in uniqueToStops
                option(value=stop.id) #{stop.label}
          .trip-filter.trip-filter_time-range
            label.form-label(for="trip-filter-time-start") Kalkış saat aralığı
            .trip-filter_time-inputs
              input#trip-filter-time-start.form-control.form-control-sm(type="time")
              span.trip-filter_time-separator –
              input#trip-filter-time-end.form-control.form-control-sm(type="time")
  #trip-results.container
    .row#trip-results-grid
      each t in tripList
        - const [tripHour = '00', tripMinute = '00'] = String(t.time || '').split(':');
        .col-4.p-3
          .trip(
            data-trip-id=(t.tripId || t.id)
            data-from-stop-id=t.fromStopId
            data-to-stop-id=t.toStopId
            data-firm=t.firm
            data-price=t.price
            data-departure-time=t.time
            data-duration=t.duration
          )
            .trip_chevron
              i.fa-solid.fa-chevron-down
            .d-flex.justify-content-between.align-items-center.px-3.mb-2
              img(src=`/images/${t.firm}.png` alt=t.firm)
              .d-flex.flex-column.align-items-center
                span.trip_time
                  i.fa-solid.fa-clock.me-1
                  span #{tripHour}:#{tripMinute}
                span #{t.duration}
            p.trip_route
              |#{t.fromStr}
              i.fa-solid.fa-route.mx-1
              |#{t.toStr}
            .d-flex.gap-3.align-items-center
              .trip_fullness
                svg(viewBox="0 0 100 100" width="3rem" height="3rem" style="max-width:100px;")
                  rect(x="20" y="20" width="60" height="60" rx="10" ry="10" fill="#fff" stroke="#333" stroke-width="2")
                  rect(x="75" y="30" width="10" height="40" rx="5" ry="5" fill="#fff" stroke="#333" stroke-width="2")
                  rect(x="15" y="30" width="10" height="40" rx="5" ry="5" fill="#fff" stroke="#333" stroke-width="2")
                  rect(x="20" y="60" width="60" height="20" rx="5" ry="5" fill="#fff" stroke="#333" stroke-width="2")
                  rect(x="35" y="55" width="30" height="30" rx="5" ry="5" fill="#fff" stroke="#333" stroke-width="2")
                span #{t.fullness}
              button.btn.btn-primary.btn-sm.w-100.trip_pick-button #{t.price}TL
            .trip_content
              .d-flex
                .trip_seat-plan
                  - const planBinary = t.busPlanBinary
                  - const plan = t.busPlan
                  - var index = 0
                  - var seat = 1
                  -for(let i = 0; i < 8; i++){
                    .d-flex
                      -for(let j = 0; j < 5; j++){
                        if planBinary[index] == "1"
                          -const genderColor = t.tickets[seat]?t.tickets[seat].gender == "m" ? "#2986cc" : "#c90076":"#fff"
                          -const genderColorStroke = t.tickets[seat]?t.tickets[seat].gender == "m" ? "#216396" : "#920256":"#b4b4b4"
                          -const genderColorText = t.tickets[seat]?t.tickets[seat].gender == "m" ? "#1a4f77" : "#720042":"#1f1f1f"
                          .trip_seat(
                            data-is-available=`${t.tickets[seat]?false:true}`
                            data-seat-number=`${plan[index]}`
                            data-trip=(t.tripId || t.id)
                          )
                            svg(viewBox="0 0 100 100" width="2.75rem" height="2.75rem" style="max-width:100px;")
                              rect(x="10" y="10" width="80" height="80" rx="10" ry="10" fill=genderColor stroke=genderColorStroke stroke-width="2")
                              rect(x="75" y="30" width="20" height="50" rx="5" ry="5" fill=genderColor stroke=genderColorStroke stroke-width="2")
                              rect(x="5" y="30" width="20" height="50" rx="5" ry="5" fill=genderColor stroke=genderColorStroke stroke-width="2")
                              rect(x="10" y="70" width="80" height="20" rx="5" ry="5" fill=genderColor stroke=genderColorStroke stroke-width="2")
                              rect(x="30" y="65" width="40" height="30" rx="5" ry="5" fill=genderColor stroke=genderColorStroke stroke-width="2")
                            span(style=`position: absolute;top: 40%;left: 50%;transform: translate(-50%, -50%);color:${genderColorText}`) #{plan[index]}
                          -seat++;
                        else 
                          svg(viewBox="0 0 100 100" width="2.75rem" height="2.75rem" style="visibility:hidden;")
                        -index++;
                      -}
                  -}
                .trip_info.p-1
                  button.trip_confirm-button.btn.btn-sm.btn-primary Onayla
    p.trip-results_empty(style=tripList.length ? 'display:none;' : '') Uygun sefer bulunamadı.

block scripts
  script(src="/js/trips.js")
